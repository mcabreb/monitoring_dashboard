# Story 3.5: Info Bar Display

## Status

Draft

## Story

**As a** user,
**I want** to see date/time, uptime, kernel version, and distro in an info bar,
**so that** I have essential system context always visible.

## Acceptance Criteria

1. Info bar is displayed at the bottom or top of the dashboard (always visible, not a panel)
2. Shows current date and time, updating every second (e.g., "2026-01-16 14:32:15")
3. Shows uptime in human-readable format (e.g., "Up: 3d 14h 22m")
4. Shows kernel version (e.g., "Kernel: 6.14.0-37-generic")
5. Shows distribution name and version (e.g., "Ubuntu 24.04")
6. Info bar uses subtle styling to not distract from main panels

## Tasks / Subtasks

- [ ] Create InfoBar widget (AC: 1)
  - [ ] Update src/monitor_dashboard/panels/info_bar.py
  - [ ] Extend textual Static or create custom widget
  - [ ] Position at bottom of dashboard layout
  - [ ] Not focusable (display-only)
- [ ] Display date/time (AC: 2)
  - [ ] Format: "YYYY-MM-DD HH:MM:SS"
  - [ ] Update every second via refresh loop
  - [ ] Use locale-appropriate format if desired
- [ ] Display uptime (AC: 3)
  - [ ] Format timedelta as "Xd Xh Xm"
  - [ ] Handle edge cases (0 days, 0 hours)
  - [ ] Implement format_uptime() utility
- [ ] Display kernel version (AC: 4)
  - [ ] Format: "Kernel: X.X.X-XX-generic"
  - [ ] Static after initial load
- [ ] Display distribution info (AC: 5)
  - [ ] Format: "Ubuntu 24.04" or "Fedora 39"
  - [ ] Combine NAME and VERSION_ID
  - [ ] Static after initial load
- [ ] Style the info bar (AC: 6)
  - [ ] Use subtle colors (dim, muted)
  - [ ] Single line, horizontal layout
  - [ ] Separator between items (│ or |)
  - [ ] Match GEM aesthetic
- [ ] Implement update method
  - [ ] Add update(info: SystemInfo) method
  - [ ] Only datetime needs per-second update
  - [ ] Other values can be cached
- [ ] Integrate with app refresh loop
  - [ ] Call info_collector.collect() in refresh loop
  - [ ] Call info_bar.update(info)

## Dev Notes

**Info Bar Layout:**
```
┌───────────────────────────────────────────────────────────────────┐
│ 2026-01-17 14:32:15 │ Up: 3d 14h 22m │ Kernel: 6.14.0-37 │ Ubuntu │
└───────────────────────────────────────────────────────────────────┘
```

Or without border (more subtle):
```
2026-01-17 14:32:15 │ Up: 3d 14h 22m │ Kernel: 6.14.0-37-generic │ Ubuntu 24.04
```

**Uptime Formatting:**
```python
def format_uptime(uptime: timedelta) -> str:
    """Format uptime as human-readable string."""
    total_seconds = int(uptime.total_seconds())
    days, remainder = divmod(total_seconds, 86400)
    hours, remainder = divmod(remainder, 3600)
    minutes = remainder // 60

    parts = []
    if days > 0:
        parts.append(f"{days}d")
    if hours > 0 or days > 0:
        parts.append(f"{hours}h")
    parts.append(f"{minutes}m")

    return "Up: " + " ".join(parts)

# Examples:
# 3 days, 14 hours, 22 minutes -> "Up: 3d 14h 22m"
# 0 days, 2 hours, 5 minutes -> "Up: 2h 5m"
# 0 days, 0 hours, 45 minutes -> "Up: 45m"
```

**InfoBar Implementation:**
```python
from textual.widgets import Static
from textual.containers import Horizontal

class InfoBar(Static):
    """Footer bar showing system information."""

    def __init__(self):
        super().__init__()
        self._static_info: SystemInfo | None = None

    def compose(self):
        yield Horizontal(
            Static("", id="datetime"),
            Static("│", classes="separator"),
            Static("", id="uptime"),
            Static("│", classes="separator"),
            Static("", id="kernel"),
            Static("│", classes="separator"),
            Static("", id="distro"),
            id="info-bar-content"
        )

    def update(self, info: SystemInfo) -> None:
        # Update datetime (changes every second)
        self.query_one("#datetime").update(
            info.current_time.strftime("%Y-%m-%d %H:%M:%S")
        )

        # Update uptime
        self.query_one("#uptime").update(format_uptime(info.uptime))

        # Update static info only on first call
        if self._static_info is None:
            self.query_one("#kernel").update(f"Kernel: {info.kernel_version}")
            self.query_one("#distro").update(
                f"{info.distro_name} {info.distro_version}".strip()
            )
            self._static_info = info
```

**CSS Styling:**
```css
InfoBar {
    dock: bottom;
    height: 1;
    background: $surface-darken-1;
    color: $text-muted;
}

#info-bar-content {
    width: 100%;
    align: center middle;
}

.separator {
    color: $text-muted;
    margin: 0 1;
}
```

**Dashboard Layout Update:**
```python
class MonitorDashboardApp(App):
    def compose(self):
        yield Container(
            # ... panel grid ...
            id="main-content"
        )
        yield InfoBar()  # At bottom
```

### Testing

**Test Location:** tests/integration/

**Testing Standards:**
- Framework: pytest with textual pilot API
- Run with: `pytest tests/integration/test_panels.py`

**Test Cases:**
```python
async def test_info_bar_displays_datetime():
    async with app.run_test() as pilot:
        bar = app.query_one(InfoBar)
        info = SystemInfo(
            current_time=datetime(2026, 1, 17, 14, 32, 15),
            uptime=timedelta(days=3, hours=14, minutes=22),
            kernel_version="6.14.0-37-generic",
            distro_name="Ubuntu",
            distro_version="24.04"
        )
        bar.update(info)

        content = str(bar.render())
        assert "2026-01-17 14:32:15" in content

async def test_info_bar_displays_uptime():
    async with app.run_test() as pilot:
        bar = app.query_one(InfoBar)
        info = SystemInfo(
            uptime=timedelta(days=3, hours=14, minutes=22),
            # ...
        )
        bar.update(info)

        content = str(bar.render())
        assert "3d 14h 22m" in content

def test_format_uptime_days():
    """Test uptime formatting with days."""
    uptime = timedelta(days=5, hours=2, minutes=30)
    assert format_uptime(uptime) == "Up: 5d 2h 30m"

def test_format_uptime_no_days():
    """Test uptime formatting without days."""
    uptime = timedelta(hours=14, minutes=5)
    assert format_uptime(uptime) == "Up: 14h 5m"

def test_format_uptime_minutes_only():
    """Test uptime formatting with only minutes."""
    uptime = timedelta(minutes=45)
    assert format_uptime(uptime) == "Up: 45m"
```

**Manual Verification:**
- Launch app and observe info bar at bottom
- Verify time updates every second
- Verify uptime is human-readable
- Verify kernel and distro are correct
- Verify styling is subtle and not distracting

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-17 | 0.1 | Initial story creation | Sarah (PO) |

---

## Dev Agent Record

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

---

## QA Results

_To be filled by QA agent_
